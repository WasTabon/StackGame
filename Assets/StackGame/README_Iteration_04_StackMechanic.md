# README — Iteration 4: Механика стека

## Что изменилось

### Новые скрипты:
- **StackChecker.cs** — проверяет все пары соседних слоёв на совпадение. Если хотя бы на одной из 4 сторон обе половинки (left и right) одинаковые — слои считаются совпавшими. Оба слоя удаляются. Анимация: белая вспышка → сжатие (InBack) → удаление → падение верхних слоёв (OutBounce). Каскадные цепные реакции через корутину — после падения проверяет заново.
- **SetupIteration4.cs** — Editor скрипт, создаёт StackChecker и прокидывает ссылки.

### Изменённые скрипты:
- **BlockLayer.cs** — добавлены Awake() для инициализации Outline (фикс из предыдущей итерации), FlashWhite() для вспышки через vertex colors, SetAllVertexColors(). SetHighlight теперь с Debug.Assert вместо тихой null-проверки.
- **InputController.cs** — OnConfirmPressed вызывает StackChecker. Добавлены SetInputLocked() (блокирует инпут во время анимаций стека), RefreshSelection() (обновляет выделение после удаления слоёв). Фикс вращения: используется RotateMode.LocalAxisAdd и сброс в Vector3.zero после вращения данных. Добавлен инпут Space/Enter для подтверждения с клавиатуры.
- **Tower.cs** — добавлен RemoveLayerAt(int index) с Debug.Assert.

## Как настроить

1. Заменить файлы: `BlockLayer.cs`, `InputController.cs`, `Tower.cs`
2. Добавить новые: `StackChecker.cs`, `Editor/SetupIteration4.cs`
3. Открыть Gameplay сцену
4. Меню: **STACK → Setup Stack Mechanic (Iteration 4)**
5. Если башня не видна — перезапустить **STACK → Setup Gameplay Scene (Iteration 1)**

## Как тестировать

1. Запустить Gameplay сцену
2. Стрелками выбрать слой и повращать его
3. Нажать кнопку ✓ (или Space/Enter) — подтвердить
4. Если есть совпадения — белая вспышка → слои сжимаются → удаляются → верхние падают с bounce
5. Если после падения образовались новые совпадения — каскадная реакция автоматически
6. Во время анимации инпут заблокирован
7. После завершения выделение обновляется

## Ожидаемый результат

Полноценная механика стека с визуальным feedback: вспышка, сжатие, падение с bounce, каскадные реакции. Инпут блокируется на время анимаций.
