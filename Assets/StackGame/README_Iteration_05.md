# README — Iteration 5: Спавн, Счёт, Game Over, Умный спавн

## Что изменилось

### Новые скрипты:
- **GameManager.cs** — игровой цикл: спавн каждые N секунд, подсчёт очков, game over
- **GameOverUI.cs** — панель Game Over с анимацией, кнопки RETRY / MENU
- **LayerSpawner.cs** — умная генерация цветов для новых слоёв:
  - Всегда гарантирует минимум одну решаемую пару в башне
  - **chainChance** (35%) — с этой вероятностью подстраивает существующие слои так чтобы удаление пары создало новую пару (каскад)
  - **nearMatchChance** (25%) — добавляет "почти совпадение" (1 из 2 цветов совпадает) чтобы игрок видел потенциал
  - Первый слой копирует цвета с верхнего слоя на случайную сторону — игрок может повернуть для матча
  - Если после генерации нет ни одной решаемой пары — принудительно создаёт одну
- **SetupIteration5.cs** — Editor скрипт

### Изменённые скрипты:
- **BlockLayer.cs** — фикс обводки (Outline создаётся после BuildVisuals), убран мёртвый rotationStep/ApplyRotation, добавлен GetRawColorIndex
- **Tower.cs** — использует LayerSpawner для генерации цветов
- **StackChecker.cs** — событие OnLayersRemoved с chainStep

## Как настроить

1. Заменить: BlockLayer.cs, Tower.cs, StackChecker.cs
2. Добавить: GameManager.cs, GameOverUI.cs, LayerSpawner.cs, Editor/SetupIteration5.cs
3. Открыть Gameplay сцену
4. **STACK → Setup Gameplay Scene (Iteration 1)** — пересоздаст башню (теперь с умным спавном)
5. **STACK → Setup GameManager and GameOver (Iteration 5)**
6. Настроить в Inspector:
   - **GameManager**: Spawn Interval (8с), Max Layers (10)
   - **LayerSpawner**: matchSide (должен совпадать с StackChecker), chainChance, nearMatchChance

## Логика умного спавна

1. Генерирует случайные 8 цветов
2. Копирует пару цветов с верхнего слоя на случайную сторону нового (гарантия матча через вращение)
3. С шансом 35% настраивает цепную реакцию: подбирает цвета так чтобы после удаления пары образовалась новая пара
4. С шансом 25% добавляет "приманку" — одна половинка совпадает (создаёт иллюзию матча, заставляет думать)
5. Финальная проверка: если ни одна пара не решаема (с учётом всех возможных вращений) — форсирует матч

## Тактики для игрока
- Можно копить слои и делать каскадные удаления (больше очков)
- Нужно просматривать все стороны через вращение
- "Почти-совпадения" подсказывают куда крутить
